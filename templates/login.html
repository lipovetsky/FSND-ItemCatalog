<html>
<head>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js">
  </script>
  <script src="//apis.google.com/js/platform.js?onload=start"> </script>
</head>

<body>

  <div id="signinButton">
    <span class="g-signin"
      data-scope="openid email"
      data-clientid="502432332243-30oj7jt3u8510ftt7cktaldsh6gsskd4.apps.googleusercontent.com"
      data-redirecturi="postmessage"
      data-accesstype="offline"
      data-cookiepolicy="single_host_origin"
      data-callback="signinCallback"
      data-approvalprompt="force">
    </span>
  </div>

<div id="result"></div>

<script>
function signInCallback(authResult) {
  if (authResult['code']) {
    // Hide sign in button when user is authorized
    $('#signinButton').attr('style', 'display: none');

    // Send one-time-use code to server. Check if server responds, then write message
    $.ajax({
      type: 'POST',
      url: '/gconnect?state={{STATE}}',
      processData: false,
      data: authResult['code'],
      contentType: 'application/octet-stream; charset=utf-8',
      success: function(result) {
        if (result) {
          $('#result').html('Login Successful!</br>' _ result + '</br>Redirecting...')
         setTimeout(function() {
           window.location.href = '/authors';
         }, 4000);

       } else if (authResult['error']) {

         console.log('There was an error: ' + authResult['error']);
       } else {
         $('#result').html('Failed to make a server-side call. Check configuation and console');
       }
      }
    });
  }
}
</script>
</body>

</html>
